<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: wp-accessibility-toolbar.php - WP Accessibility Hook Doumentation</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="styles-docs.css?v=0.1.2">
</head>

<body>

<div id="main">

    <header><h1 class="page-title">Source: wp-accessibility-toolbar.php</h1></header>
	<main>
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>&lt;?php
/**
 * Generate Toolbar HTML &amp; JS
 *
 * @category Toolbar
 * @package  WP Accessibility
 * @author   Joe Dolson
 * @license  GPLv2 or later
 * @link     https://www.joedolson.com/wp-accessibility/
 */

/**
 * Toolbar class.
 */
require_once __DIR__ . '/class-wp-accessibility-toolbar.php';

add_action( 'widgets_init', 'wpa_register_toolbar_widget' );
/**
 * Register toolbar widget.
 */
function wpa_register_toolbar_widget() {
	register_widget( 'Wp_Accessibility_Toolbar' );
}

add_action( 'wp_enqueue_scripts', 'wpa_register_scripts' );
/**
 * Register jQuery scripts.
 */
function wpa_register_scripts() {
	$wpa_version = ( SCRIPT_DEBUG ) ? wp_rand( 10000, 100000 ) : wpa_check_version();
	$wpatb       = ( SCRIPT_DEBUG ) ? plugins_url( 'js/wpa-toolbar.js', __FILE__ ) : plugins_url( 'js/wpa-toolbar.min.js', __FILE__ );
	wp_register_script( 'wpa-toolbar', $wpatb, array(), $wpa_version, true );
	$wpaui = ( SCRIPT_DEBUG ) ? plugins_url( 'js/a11y.js', __FILE__ ) : plugins_url( 'js/a11y.min.js', __FILE__ );
	wp_register_script( 'ui-a11y', $wpaui, array( 'jquery' ), $wpa_version, true );
}

add_action( 'wp_enqueue_scripts', 'wpa_toolbar_enqueue_scripts' );
/**
 * Enqueue Toolbar scripts dependent on options.
 */
function wpa_toolbar_enqueue_scripts() {
	$wpa_version = ( SCRIPT_DEBUG ) ? wp_rand( 10000, 100000 ) : wpa_check_version();
	wp_enqueue_script( 'jquery' );
	if ( 'on' === get_option( 'wpa_toolbar' ) ) {
		// Enqueue Toolbar JS if enabled.
		wp_enqueue_script( 'wpa-toolbar' );
		wp_localize_script( 'wpa-toolbar', 'wpatb', wpa_toolbar_js() );
	}
	wp_enqueue_script( 'ui-a11y' );

	// High Contrast CSS.
	$plugin_path = plugins_url( 'toolbar/css/a11y-contrast.css', __FILE__ );
	if ( file_exists( get_stylesheet_directory() . '/a11y-contrast.css' ) ) {
		$plugin_path = get_stylesheet_directory_uri() . '/a11y-contrast.css';
	}
	$plugin_path = array(
		'path' => add_query_arg( 'version', $wpa_version, $plugin_path ),
	);
	wp_localize_script( 'ui-a11y', 'wpa11y', $plugin_path );

	// Font files for toolbar.
	wp_register_style( 'ui-font', plugins_url( 'toolbar/fonts/css/a11y-toolbar.css', __FILE__ ), array(), $wpa_version );

	// Toolbar CSS.
	/**
	 * Filter URL for toolbar CSS.
	 *
	 * @hook wpa_toolbar_css
	 *
	 * @param {string} $url URL to stylesheet for accessibility toolbar.
	 *
	 * @return string
	 */
	$toolbar_styles = apply_filters( 'wpa_toolbar_css', plugins_url( 'toolbar/css/a11y.css', __FILE__ ) );
	wp_register_style( 'ui-a11y', $toolbar_styles, array( 'ui-font' ), $wpa_version );

	// Font resizing stylesheet.
	$fontsize_stylesheet = ( 'on' === get_option( 'wpa_alternate_fontsize' ) ) ? 'a11y-fontsize-alt' : 'a11y-fontsize';
	/**
	 * Filter the URL to the stylesheet controlling large font views.
	 *
	 * @hook wpa_fontsize_css
	 *
	 * @param {string} $stylesheet URL for increased font size stylesheet.
	 *
	 * @return string
	 */
	$fontsize = apply_filters( 'wpa_fontsize_css', plugins_url( 'toolbar/css/' . $fontsize_stylesheet . '.css', __FILE__ ) );
	wp_register_style( 'ui-fontsize.css', $fontsize, array(), $wpa_version );
	if ( 'on' === get_option( 'wpa_alternate_fontsize' ) ) {
		$vars = 'html { --wpa-font-size: 150%; }';
	} else {
		$vars = 'html { --wpa-font-size: clamp( 24px, 1.5rem, 36px ); --wpa-h1-size : clamp( 48px, 3rem, 72px ); --wpa-h2-size : clamp( 40px, 2.5rem, 60px ); --wpa-h3-size : clamp( 32px, 2rem, 48px ); --wpa-h4-size : clamp( 28px, 1.75rem, 42px ); --wpa-sub-list-size: 1.1em; --wpa-sub-sub-list-size: 1em; } ';
	}
	wp_add_inline_style( 'ui-fontsize.css', $vars );

	// Control toolbar font size.
	$toolbar_size = get_option( 'wpa_toolbar_size' );
	$toolbar_size = ( false === stripos( $toolbar_size, 'em' ) ) ? $toolbar_size . 'px' : $toolbar_size;
	// Only enable styles when required by options.
	if ( get_option( 'wpa_toolbar_size' ) &amp;&amp; 'on' === get_option( 'wpa_toolbar' ) ) {
		wp_add_inline_style( 'ui-a11y', '.a11y-toolbar ul li button { font-size: ' . $toolbar_size . ' !important; }' );
	}
	if ( $toolbar_styles &amp;&amp; $fontsize ) {
		wp_enqueue_style( 'ui-a11y' );
		wp_enqueue_style( 'ui-fontsize.css' );
	}
}

add_shortcode( 'wpa_toolbar', 'wpa_toolbar_shortcode' );
/**
 * Output Toolbar shortcode
 *
 * @param array  $atts Shortcode attributes.
 * @param string $content Contained content.
 *
 * @return string
 */
function wpa_toolbar_shortcode( $atts, $content ) {
	$args = shortcode_atts(
		array(
			'type'    => 'widget',
			'control' => 'button',
		),
		$atts,
		'wpa_toolbar'
	);

	return wpa_toolbar_html( $args['type'], $args['control'] );
}

/**
 * Generate Toolbar as HTML.
 *
 * @param string $type widget, shortcode, js generated.
 * @param string $control Control type: button or not.
 *
 * @return string HTML.
 */
function wpa_toolbar_html( $type = 'widget', $control = 'button' ) {
	$contrast         = esc_html__( 'Toggle High Contrast', 'wp-accessibility' );
	$grayscale        = esc_html__( 'Toggle Grayscale', 'wp-accessibility' );
	$fontsize         = esc_html__( 'Toggle Font size', 'wp-accessibility' );
	$enable_grayscale = ( 'on' === get_option( 'wpa_toolbar_gs' ) &amp;&amp; current_user_can( 'manage_options' ) ) ? true : false;
	$enable_contrast  = ( 'off' === get_option( 'wpa_toolbar_ct' ) ) ? false : true;
	$enable_fontsize  = ( 'off' === get_option( 'wpa_toolbar_fs' ) ) ? false : true;
	$responsive       = ( 'on' === get_option( 'wpa_toolbar_mobile' ) ) ? 'a11y-responsive ' : '';
	$is_rtl           = ( is_rtl() ) ? ' rtl' : ' ltr';
	$is_reversed      = ( 'on' === get_option( 'wpa_toolbar_right' ) ) ? ' reverse' : ' default';
	$toolbar_type     = ( 'widget' === $type ) ? 'a11y-toolbar-widget' : 'a11y-toolbar';
	$control_type     = ( 'button' !== $control ) ? 'a href="#" role="button"' : 'button type="button"'; // button control does not work in Edge.
	$closure          = ( 'button' !== $control ) ? 'a' : 'button';  // button control does not work in Edge.
	$toolbar          = '
&lt;!-- a11y toolbar widget -->
&lt;div class="' . $responsive . ' ' . $is_rtl . ' ' . $is_reversed . ' ' . $toolbar_type . '">
	&lt;ul>';
	if ( $enable_contrast ) {
		$toolbar .= '&lt;li>&lt;' . $control_type . ' class="a11y-toggle a11y-toggle-contrast toggle-contrast" id="is_normal_contrast" aria-pressed="false">&lt;span class="offscreen">' . $contrast . '&lt;/span> &lt;span class="aticon aticon-adjust" aria-hidden="true">&lt;/span>&lt;/' . $closure . '>&lt;/li>';
	}
	if ( $enable_grayscale ) {
		$toolbar .= '&lt;li>&lt;' . $control_type . ' class="a11y-toggle a11y-toggle-grayscale toggle-grayscale" id="is_normal_color" aria-pressed="false">&lt;span class="offscreen">' . $grayscale . '&lt;/span> &lt;span class="aticon aticon-tint" aria-hidden="true">&lt;/span>&lt;/' . $closure . '>&lt;/li>';
	}
	if ( $enable_fontsize ) {
		$toolbar .= '&lt;li>&lt;' . $control_type . ' class="a11y-toggle a11y-toggle-fontsize toggle-fontsize" id="is_normal_fontsize" aria-pressed="false">&lt;span class="offscreen">' . $fontsize . '&lt;/span> &lt;span class="aticon aticon-font" aria-hidden="true">&lt;/span>&lt;/' . $closure . '>&lt;/li>';
	}
	$toolbar .= '
	&lt;/ul>
&lt;/div>
&lt;!-- // a11y toolbar widget -->';

	return $toolbar;
}

/**
 * Generate Toolbar variables for localization in JS.
 */
function wpa_toolbar_js() {
	$default = ( false !== (bool) trim( get_option( 'wpa_toolbar_default' ) ) ) ? get_option( 'wpa_toolbar_default' ) : 'body';
	/**
	 * Filter attachment location of the toolbar. Default `body`.
	 *
	 * @hook wpa_move_toolbar
	 *
	 * @param {string} $el Target element selector.
	 *
	 * @return string
	 */
	$location         = apply_filters( 'wpa_move_toolbar', $default );
	$is_rtl           = ( is_rtl() ) ? 'rtl' : 'ltr';
	$is_reversed      = ( 'on' === get_option( 'wpa_toolbar_right' ) ) ? 'reversed' : 'default';
	$responsive       = ( 'on' === get_option( 'wpa_toolbar_mobile' ) ) ? 'a11y-responsive' : 'a11y-non-responsive';
	$custom_location  = ( '' !== get_option( 'wpa_toolbar_default' ) ) ? 'custom-location' : '';
	$contrast         = esc_html__( 'Toggle High Contrast', 'wp-accessibility' );
	$grayscale        = esc_html__( 'Toggle Grayscale', 'wp-accessibility' );
	$fontsize         = esc_html__( 'Toggle Font size', 'wp-accessibility' );
	$enable_grayscale = ( 'on' === get_option( 'wpa_toolbar_gs' ) &amp;&amp; current_user_can( 'manage_options' ) ) ? 'true' : 'false';
	$enable_fontsize  = ( 'off' === get_option( 'wpa_toolbar_fs' ) ) ? 'false' : 'true';
	$enable_contrast  = ( 'off' === get_option( 'wpa_toolbar_ct' ) ) ? 'false' : 'true';

	return array(
		'location'         => $location,
		'is_rtl'           => $is_rtl,
		'is_right'         => $is_reversed,
		'responsive'       => $responsive,
		'contrast'         => $contrast,
		'grayscale'        => $grayscale,
		'fontsize'         => $fontsize,
		'custom_location'  => $custom_location,
		'enable_grayscale' => $enable_grayscale,
		'enable_fontsize'  => $enable_fontsize,
		'enable_contrast'  => $enable_contrast,
	);
}
</code></pre>
        </article>
    </section>




	</main>
    <footer>
		<a href="https://make.wordpress.org/accessibility/handbook/which-tools-can-i-use/wp-accessibility-plugin/">WP Accessibility User Documentation</a> &bull;
		<a href="https://github.com/joedolson/wp-accessibility/">WP Accessibility on GitHub</a> &bull;
	</footer>

	
</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Actions</h3><ul><li><a href="wpa_save_stats_post.html">wpa_save_stats_post</a></li><li><a href="wpa_save_stats_update.html">wpa_save_stats_update</a></li></ul><h3>Filters</h3><ul><li><a href="asl_extra_target.html">asl_extra_target</a></li><li><a href="asl_sitemap.html">asl_sitemap</a></li><li><a href="wpa_case_insensitive.html">wpa_case_insensitive</a></li><li><a href="wpa_case_sensitive.html">wpa_case_sensitive</a></li><li><a href="wpa_disable_labels.html">wpa_disable_labels</a></li><li><a href="wpa_fontsize_css.html">wpa_fontsize_css</a></li><li><a href="wpa_get_current_url.html">wpa_get_current_url</a></li><li><a href="wpa_labels.html">wpa_labels</a></li><li><a href="wpa_long_alt.html">wpa_long_alt</a></li><li><a href="wpa_move_toolbar.html">wpa_move_toolbar</a></li><li><a href="wpa_remove_titles.html">wpa_remove_titles</a></li><li><a href="wpa_show_alt_selector.html">wpa_show_alt_selector</a></li><li><a href="wpa_skiplink_styles.html">wpa_skiplink_styles</a></li><li><a href="wpa_stats_data_point.html">wpa_stats_data_point</a></li><li><a href="wpa_summary_heading.html">wpa_summary_heading</a></li><li><a href="wpa_summary_heading_level.html">wpa_summary_heading_level</a></li><li><a href="wpa_toolbar_css.html">wpa_toolbar_css</a></li><li><a href="wpa_track_view_statistics.html">wpa_track_view_statistics</a></li><li><a href="wpa_underline_target.html">wpa_underline_target</a></li><li><a href="wpa_view_remediation_logs.html">wpa_view_remediation_logs</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-change-accessibility-toolbar-attachment-element.html">change-accessibility-toolbar-attachment-element</a></li><li><a href="tutorial-custom-fontsize-stylesheet.html">custom-fontsize-stylesheet</a></li></ul>
</nav>

<br class="clear">

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
